<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Distance Calculator Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .coordinates {
            font-family: monospace;
            background-color: #f8f9fa;
            padding: 5px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Distance Calculator Test Suite</h1>
        <p>This page tests the accuracy of the distance calculation system.</p>

        <div class="test-section">
            <h2>üìç Test Locations</h2>
            <div id="testLocations">
                <p>Loading test locations...</p>
            </div>
        </div>

        <div class="test-section">
            <h2>üöó Distance Calculation Tests</h2>
            <button onclick="runDistanceTests()">Run Distance Tests</button>
            <div id="distanceResults"></div>
        </div>

        <div class="test-section">
            <h2>üì± Mobile Location Test</h2>
            <button onclick="testMobileLocation()">Test My Location</button>
            <div id="mobileResults"></div>
        </div>

        <div class="test-section">
            <h2>üè™ Company Distance Test</h2>
            <button onclick="testCompanyDistances()">Test Company Distances</button>
            <div id="companyResults"></div>
        </div>
    </div>

    <script src="js/distanceCalculator.js"></script>
    <script>
        // Test locations in Ghana
        const testLocations = {
            'Accra Central': { lat: 5.6037, lng: -0.1870 },
            'Tema Community 1': { lat: 5.6800, lng: -0.0100 },
            'Kumasi Adum': { lat: 6.6885, lng: -1.6244 },
            'Takoradi Central': { lat: 4.8845, lng: -1.7554 },
            'Cape Coast': { lat: 5.1036, lng: -1.2466 },
            'Ho': { lat: 6.6000, lng: 0.4700 },
            'Tamale': { lat: 9.3991, lng: -0.8393 },
            'Sunyani': { lat: 7.3404, lng: -2.3355 },
            'Labone': { lat: 5.5580, lng: -0.1920 },
            'East Legon': { lat: 5.6300, lng: -0.1600 },
            'Madina': { lat: 5.6500, lng: -0.2300 },
            'Kasoa': { lat: 5.5200, lng: -0.2800 }
        };

        // Initialize test locations display
        function initializeTestLocations() {
            const container = document.getElementById('testLocations');
            let html = '<table style="width: 100%; border-collapse: collapse;">';
            html += '<tr><th style="border: 1px solid #ddd; padding: 8px;">Location</th><th style="border: 1px solid #ddd; padding: 8px;">Coordinates</th></tr>';
            
            for (const [name, coords] of Object.entries(testLocations)) {
                html += `<tr>
                    <td style="border: 1px solid #ddd; padding: 8px;">${name}</td>
                    <td style="border: 1px solid #ddd; padding: 8px;" class="coordinates">${coords.lat.toFixed(4)}, ${coords.lng.toFixed(4)}</td>
                </tr>`;
            }
            
            html += '</table>';
            container.innerHTML = html;
        }

        // Run distance calculation tests
        async function runDistanceTests() {
            const resultsDiv = document.getElementById('distanceResults');
            resultsDiv.innerHTML = '<p>Running distance tests...</p>';

            const testPairs = [
                ['Accra Central', 'Tema Community 1'],
                ['Accra Central', 'Kumasi Adum'],
                ['Accra Central', 'Takoradi Central'],
                ['Accra Central', 'Cape Coast'],
                ['Tema Community 1', 'Kumasi Adum'],
                ['Labone', 'East Legon'],
                ['Madina', 'Kasoa']
            ];

            let results = '<h3>Test Results:</h3>';
            
            for (const [from, to] of testPairs) {
                try {
                    const fromCoords = testLocations[from];
                    const toCoords = testLocations[to];
                    
                    if (!fromCoords || !toCoords) {
                        results += `<div class="test-result error">‚ùå Missing coordinates for ${from} or ${to}</div>`;
                        continue;
                    }

                    const result = await window.distanceCalculator.calculateDistanceAndTime(fromCoords, toCoords);
                    
                    results += `<div class="test-result success">
                        ‚úÖ ${from} ‚Üí ${to}: 
                        ${result.distance.text} (${result.distance.km.toFixed(2)} km), 
                        ${result.duration.text}, 
                        Source: ${result.source}, 
                        Accuracy: ${result.accuracy || 'N/A'}
                    </div>`;
                    
                } catch (error) {
                    results += `<div class="test-result error">‚ùå ${from} ‚Üí ${to}: ${error.message}</div>`;
                }
            }

            resultsDiv.innerHTML = results;
        }

        // Test mobile location
        async function testMobileLocation() {
            const resultsDiv = document.getElementById('mobileResults');
            resultsDiv.innerHTML = '<p>Testing mobile location...</p>';

            if (!navigator.geolocation) {
                resultsDiv.innerHTML = '<div class="test-result error">‚ùå Geolocation not supported</div>';
                return;
            }

            try {
                const position = await new Promise((resolve, reject) => {
                    navigator.geolocation.getCurrentPosition(resolve, reject, {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    });
                });

                const userCoords = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                let results = `<div class="test-result success">
                    üìç Your location: ${userCoords.lat.toFixed(6)}, ${userCoords.lng.toFixed(6)}
                    (Accuracy: ¬±${Math.round(position.coords.accuracy)}m)
                </div>`;

                // Test distances to major cities
                for (const [city, coords] of Object.entries(testLocations)) {
                    try {
                        const distance = await window.distanceCalculator.calculateDistanceAndTime(userCoords, coords);
                        results += `<div class="test-result info">
                            üìè Distance to ${city}: ${distance.distance.text}, ${distance.duration.text}
                        </div>`;
                    } catch (error) {
                        results += `<div class="test-result error">‚ùå Failed to calculate distance to ${city}: ${error.message}</div>`;
                    }
                }

                resultsDiv.innerHTML = results;

            } catch (error) {
                resultsDiv.innerHTML = `<div class="test-result error">‚ùå Location access denied: ${error.message}</div>`;
            }
        }

        // Test company distances (mock data)
        async function testCompanyDistances() {
            const resultsDiv = document.getElementById('companyResults');
            resultsDiv.innerHTML = '<p>Testing company distances...</p>';

            // Mock company data
            const mockCompanies = [
                { name: 'Accra Water Shop 1', location: 'Osu, Accra', coordinates: testLocations['Labone'] },
                { name: 'Accra Water Shop 2', location: 'East Legon, Accra', coordinates: testLocations['East Legon'] },
                { name: 'Tema Water Shop', location: 'Tema Community 1', coordinates: testLocations['Tema Community 1'] },
                { name: 'Kumasi Water Shop', location: 'Kumasi Adum', coordinates: testLocations['Kumasi Adum'] },
                { name: 'Takoradi Water Shop', location: 'Takoradi Central', coordinates: testLocations['Takoradi Central'] }
            ];

            // Use Accra Central as user location for testing
            const userLocation = testLocations['Accra Central'];
            
            let results = `<div class="test-result info">
                üß™ Using Accra Central as test user location
            </div>`;

            // Calculate distances for all companies
            const companiesWithDistance = [];
            
            for (const company of mockCompanies) {
                try {
                    const distance = await window.distanceCalculator.calculateDistanceAndTime(userLocation, company.coordinates);
                    companiesWithDistance.push({
                        ...company,
                        distance: distance.distance.km,
                        time: distance.duration.text,
                        accuracy: distance.accuracy || 'estimated'
                    });
                } catch (error) {
                    results += `<div class="test-result error">‚ùå Failed to calculate distance for ${company.name}: ${error.message}</div>`;
                }
            }

            // Sort by distance
            companiesWithDistance.sort((a, b) => a.distance - b.distance);

            results += '<h4>Companies sorted by distance from Accra Central:</h4>';
            companiesWithDistance.forEach((company, index) => {
                const accuracyBadge = company.accuracy === 'high' ? 'üü¢' : company.accuracy === 'estimated' ? 'üü°' : '‚ö™';
                results += `<div class="test-result success">
                    ${index + 1}. ${company.name}: ${company.distance.toFixed(1)} km away, ${company.time} ${accuracyBadge}
                </div>`;
            });

            resultsDiv.innerHTML = results;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeTestLocations();
            
            // Check if distance calculator is loaded
            if (window.distanceCalculator) {
                console.log('‚úÖ Distance calculator loaded successfully');
            } else {
                console.error('‚ùå Distance calculator not loaded');
            }
        });
    </script>
</body>
</html>
